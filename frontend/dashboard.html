<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="dataFetcher.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- <script src="path/to/chart-js.js"></script> -->

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link rel='stylesheet' href='styles_deshbord.css'>

    <title>Nasa Simulator!</title>
    <style>
        .container-smaller {
            max-width: 800px;
            /* Set the maximum width of the container */
            margin: 0 auto;
            /* Center the container horizontally */
            position: fixed;
            /* Position the container */
            bottom: 20px;
            /* Distance from the bottom of the page */
            right: 20px;
            /* Distance from the right side of the page */
            background-color: rgba(0, 0, 0, 0.8);
            /* Optional background color */
            padding: 10px;
            /* Optional padding */
            border-radius: 10px;
            /* Optional border-radius for rounded corners */
            color: white;
            /* Optional text color */
        }

        /* Style for the smaller table */
        #dataContainer {
            font-size: 14px;
        }

        /* Style for the parent container */
        .parent-container {
            position: relative;
        }

        /* Style for the title above the table */
        .table-title {
            font-size: 18px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1 class="text-center mt-3" style="color: white;">Welcome to the Astronomical Events Portal!</h1>

    <ul class="nav nav-pills nav-fill">
        <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="dashboard.html" data-toggle="pill"
                style="color: azure;">
                <i class="fas fa-chart-bar" style="color: azure;"></i> Dashboard
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="Astronomical_events.html" style="color: azure;">
                <i class="fas fa-moon" style="color: azure;"></i> Astronomical events
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="nasa.html" style="color: azure;">
                <i class="fas fa-rocket" style="color: azure;"></i> NASA
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="sun.html" style="color: azure;">
                <i class="fas fa-sun" style="color: azure;"></i> Sun
            </a>
        </li>
    </ul>
    <div class="container">
        <div class="row mt-3">
            <div class="col-sm-6">
                <h5 class="card-title" style="color: azure;  font-family: 'Trebuchet MS', sans-serif;">Last
                    Astronomical Events Data</h5>
                <table id="dataContainerTable1" class="table table-bordered table-sm"
                    style="font-family: sans-serif; color: white; background-color: rgba(0, 0, 0, 0.3);">
                    <thead>
                        <tr>
                            <th>Event number</th>
                            <th>Date</th>
                            <th>Informing Factor</th>
                            <th>Location</th>
                            <th>event Type</th>
                            <th>severity Level</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="col-sm-6">
                <h5 class="card-title" style="color: azure;  font-family: 'Trebuchet MS', sans-serif;">
                    Future Astronomical Events Data</h5>
                <table id="dataContainerTable2" class="table table-bordered table-sm"
                    style=" font-family: sans-serif; color: white; background-color: rgba(0, 0, 0, 0.3);">
                    <thead>
                        <tr>
                            <th>Event number</th>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Estimated diameter</th>
                            <th>Hazardous asteroid</th>
                            <th>Close approach data</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <!-- Analytics title above the charts -->
            <div class="row mt-3">
                <div class="col-sm-12">
                    <h5 class="card-title text-center" style="color: rgba(255, 192, 203, 0.7); background-color: rgb(0, 0, 0, 0.3);  
                        font-family: 'Trebuchet MS', sans-serif; font-size: 38px;">Analytics</h5>
                </div>
                <!-- Charts row -->
                <div class="row mt-3">
                    <!-- Chart containers with some space between them -->
                    <div class="col-md-6 mb-4">
                        <div class="chart-container">
                            <canvas id="severityChart" width="500" height="300"
                                style="background-color: rgb(0, 0, 0, 0.3);"></canvas>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="chart-container">
                            <canvas id="eventTypeChart" width="500" height="330"
                                style="background-color: rgb(0, 0, 0, 0.3);"></canvas>
                        </div>
                    </div>
                    <!-- Chart container -->
                    <div class="col-md-6 mb-4">
                        <div class="chart-container">
                            <canvas id="distanceChart" width="500" height="300"
                                style="background-color: rgb(0, 0, 0, 0.3);"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- <canvas id="closeApproachChart" width="400" height="200"></canvas>
        <canvas id="sunXChart" width="400" height="200"></canvas> -->


        <div id="dataContainer" class="d-flex flex-row flex-wrap" style="font-family: Monaco;"></div>
    </div>


    <script>
      function processDataForGraph(data) {
            // Extract distances from all the dates
            const allDistances = [];
            for (const date in data.near_earth_objects) {
                const eventsForDate = data.near_earth_objects[date];
                const distances = eventsForDate.map((item) => item.close_approach_data[0].miss_distance.kilometers);
                allDistances.push(...distances);
            }

            return allDistances;
        }


    // New function to create distance distribution graph
    function createDistanceDistributionGraph(data) {
      const distances = processDataForGraph(data);
      const ctx = document.getElementById('distanceChart').getContext('2d');

      const distanceChartConfig = {
        type: 'bar',
        data: {
          labels: distances,
          datasets: [{
            label: 'Number of Events',
            data: Array.from({ length: distances.length }, () => 1), // Assuming each distance occurs once
            backgroundColor: 'rgba(255, 192, 203, 0.7)',
            borderColor: 'rgba(255, 192, 203, 0.7)',
            borderWidth: 1,
          }],
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Number of Events',
                color: 'white',
                font: {
                  weight: 'bold',
                },
              },
              grid: {
                color: 'white',
                backgroundColor: 'white',
                borderWidth: 1,
                drawBorder: false,
              },
              ticks: {
                color: 'white',
              },
            },
            x: {
              title: {
                display: true,
                text: 'Distance (kilometers)',
                color: 'white',
                font: {
                  weight: 'bold',
                },
              },
              grid: {
                color: 'white',
                backgroundColor: 'white',
                borderWidth: 1,
                drawBorder: false,
              },
              ticks: {
                color: 'white',
              },
            },
          },
          plugins: {
            legend: {
              labels: {
                color: 'white',
                font: {
                  weight: 'bold',
                },
              },
            },
          },
        },
      };

      new Chart(ctx, distanceChartConfig);
    }

    // Call createDistanceDistributionGraph() function when the page loads
    window.addEventListener('DOMContentLoaded', () => {
      fetch('http://localhost:4001/nasa')
        .then(response => response.json())
        .then(data => {
          // Existing code to display the last five events in the table

          // Create the distance distribution graph
          createDistanceDistributionGraph(data);
        })
        .catch(error => {
          console.error('Error:', error);
        });
    });
        // Call getData() function 
        window.addEventListener('DOMContentLoaded', () => {
            const url = 'http://localhost:3000/data-5events'; // Modify the URL accordingly
            const targetContainerId = 'dataContainerTable1'; // Modify the container ID accordingly
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    populateTableData(data, targetContainerId);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        window.addEventListener('DOMContentLoaded', () => {
            fetch('http://localhost:4001/nasa')
                .then(response => response.json())
                .then(data => {
                    const dataContainer2 = document.getElementById('dataContainerTable2');
                    const nearEarthObjects = data.near_earth_objects;

                    // Get all events and sort them by date in descending order
                    const allEvents = [];
                    for (const date in nearEarthObjects) {
                        const objects = nearEarthObjects[date];
                        allEvents.push(...objects);
                    }
                    allEvents.sort((a, b) => new Date(b.close_approach_data[0].close_approach_date) - new Date(a.close_approach_data[0].close_approach_date));

                    // Get only the last 5 events
                    const lastFiveEvents = allEvents.slice(0, 5);

                    const tbody = dataContainer2.querySelector('tbody'); // Get the <tbody> element

                    lastFiveEvents.forEach((item, index) => {
                        const row = document.createElement('tr'); // Create a table row
                        const eventNumberCell = document.createElement('td');
                        eventNumberCell.textContent = index + 1;
                        row.appendChild(eventNumberCell);

                        const keys = ['id', 'name', 'estimated_diameter', 'is_potentially_hazardous_asteroid', 'close_approach_data'];

                        keys.forEach(key => {
                            const cell = document.createElement('td'); // Create a table data cell

                            const valueSpan = document.createElement('span');
                            valueSpan.style.fontSize = 'x-scale';

                            if (key === 'estimated_diameter') {
                                const diameter = item[key];
                                valueSpan.textContent = `Min: ${diameter.kilometers.estimated_diameter_min}, Max: ${diameter.kilometers.estimated_diameter_max}`;
                            }
                            else if (key === 'close_approach_data') {
                                const data = item[key];
                                valueSpan.textContent = `Date: ${data[0].close_approach_date_full}, Distance: ${data[0].miss_distance.kilometers}`;
                            }
                            else {
                                valueSpan.textContent = item[key];
                            }

                            cell.appendChild(valueSpan);
                            row.appendChild(cell);
                        });

                        tbody.appendChild(row); // Add the row to the <tbody> element
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });

        const startDateInput = "2023/07/06";
        const endDateInput = "2023/07/28";

        const severityChartCofig = {
            type: 'bar',
            data: {
                id: 'severityChart',
                labels: ['1', '2', '3', '4', '5'], // Severity levels
                datasets: [{
                    label: 'Number of Events',
                    data: [0, 0, 0, 0, 0], // Number of events
                    backgroundColor: 'rgba(255, 192, 203, 0.7)', // Change the background color to white with transparency
                    borderColor: 'rgba(255, 192, 203, 0.7)', // Change the border color to white
                    borderWidth: 1,
                    color: 'white',
                }],
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Events',
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }
                        },
                        grid: {
                            // light pink color
                            color: 'white',
                            backgroundColor: 'white',
                            borderWidth: 1,
                            drawBorder: false,
                        },
                        ticks: {
                            color: 'white',
                        },
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Severity Level',
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }

                        },
                        grid: {
                            color: 'white',
                            backgroundColor: 'white',
                            borderWidth: 1,
                            drawBorder: false,
                        },
                        ticks: {
                            color: 'white',
                        },
                    },
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }
                        }
                    }
                }
            },


        }

        // // const closeApproachChartConfig = {
        // // }

        // // const sunXChartConfig = {
        // // }

        const eventTypeChartConfig = {
            type: 'bar',
            data: {
                id: 'eventTypeChart',
                labels: ['MMT', 'Gemini Observatory Telescopes', 'Very Large Telescope', 'Subaru Telescope', 'Large Binocular Telescope', 'Southern African Large Telescope',
                    'Keck 1 and 2', 'Hobby-Eberly Telescope', 'Gran Telescopio Canarias', 'The Giant Magellan Telescope', 'Thirty Meter Telescope', 'European Extremely Large Telescope'], // Event types
                datasets: [{
                    label: 'Number of Events',
                    fontColor: 'white',
                    data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0], // Number of events
                    backgroundColor: 'rgba(255, 192, 203, 0.7)', // Change the background color to white with transparency
                    borderColor: 'rgba(255, 192, 203, 0.7)', // Change the border color to white
                    borderWidth: 1,
                    color: 'white',
                }],
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Events',
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }
                        },
                        grid: {
                            // light pink color
                            color: 'white',
                            backgroundColor: 'white',
                            borderWidth: 1,
                            drawBorder: false,
                        },
                        ticks: {
                            color: 'white',
                        },
                    },
                    x: {
                        title: {
                            display: true,
                            // text: 'Severity Level',
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }

                        },
                        grid: {
                            color: 'white',
                            backgroundColor: 'white',
                            borderWidth: 1,
                            drawBorder: false,
                        },
                        ticks: {
                            color: 'white',
                        },
                    },
                },
                plugins: {
                    legend: {
                        labels: {
                            color: 'white',
                            font: {
                                weight: 'bold',
                            }
                        }
                    }
                }
            },
        };

        function updateCharts(data) {
            const severityLevels = [1, 2, 3, 4, 5];
            const eventsCountBySeverity = Array(5).fill(0);

            const eventTypeLabels = [
                'GRB', 'Apparent Brightness Rise', 'UV Rise', 'X-Ray Rise', 'Comet'
            ];
            const eventsCountByEventType = Array(12).fill(0);

            data.forEach((item) => {
                const severity = item.severityLevel;
                eventsCountBySeverity[severity - 1]++;

                const eventTypeIndex = eventTypeLabels.indexOf(item.eventType);
                console.log(item.eventType);
                if (eventTypeIndex !== -1) {
                    eventsCountByEventType[eventTypeIndex]++;
                }
            });



            severityChartCofig.data.labels = severityLevels;
            severityChartCofig.data.datasets[0].data = eventsCountBySeverity;

            eventTypeChartConfig.data.labels = eventTypeLabels;
            eventTypeChartConfig.data.datasets[0].data = eventsCountByEventType;

            // Get the canvas elements and draw the charts
            const severityCtx = document.getElementById('severityChart').getContext('2d');
            severityChart = new Chart(severityCtx, severityChartCofig);
            const eventTypeCtx = document.getElementById('eventTypeChart').getContext('2d');
            eventTypeChart = new Chart(eventTypeCtx, eventTypeChartConfig);
        }

        // Call getData() function when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            fetch(`http://localhost:3000/data-times?start_date=${startDateInput}&end_date=${endDateInput}`)
                .then((response) => response.json())
                .then((data) => {

                    const dataContainer = document.getElementById('dataContainer');
                    // ... Existing code to display dataContainer

                    // Update the chart with the retrieved data
                    updateCharts(data);
                    // updateSeverityChart(data);
                    // updateEventTypeChart(data);
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
        });





    </script>
</body>

</html>